name: PR Check

on:
    pull_request:
        branches: [main]
    workflow_dispatch:

permissions:
    contents: read
    packages: read

jobs:
    check:
        name: ä»£ç æ£€æŸ¥
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v3
              with:
                  token: ${{ secrets.PAT_TOKEN }}

            - name: Setup Go Environment
              uses: ./.github/actions/setup
              with:
                  pat-token: ${{ secrets.PAT_TOKEN }}

            - name: ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç 
              run: |
                  make wire

            - name: ç¼–è¯‘æµ‹è¯•
              run: |
                  echo "å¼€å§‹ç¼–è¯‘æµ‹è¯•..."
                  make build

            - name: è¿è¡Œæµ‹è¯•
              run: |
                  echo "è¿è¡Œå•å…ƒæµ‹è¯•..."
                  make test

            - name: æ£€æŸ¥ç¼–è¯‘äº§ç‰©
              run: |
                  if [ -f "bin/godemo" ]; then
                      echo "âœ… ç¼–è¯‘æˆåŠŸ"
                      ls -la bin/
                      echo "âœ… æ–‡ä»¶å¤§å°: $(du -h bin/godemo | cut -f1)"
                  else
                      echo "âŒ ç¼–è¯‘å¤±è´¥"
                      exit 1
                  fi

            - name: ä»£ç è´¨é‡æŠ¥å‘Š
              run: |
                  echo "=== ä»£ç è´¨é‡æ£€æŸ¥å®Œæˆ ==="
                  echo "âœ… ä»£ç æ ¼å¼æ£€æŸ¥é€šè¿‡"
                  echo "âœ… ä»£ç é—®é¢˜æ£€æŸ¥é€šè¿‡"
                  echo "âœ… ç¼–è¯‘æµ‹è¯•é€šè¿‡"
                  echo "âœ… å•å…ƒæµ‹è¯•é€šè¿‡"
                  echo "âœ… ç¼–è¯‘äº§ç‰©éªŒè¯é€šè¿‡"
                  echo "ğŸ‰ PRæ£€æŸ¥å…¨éƒ¨é€šè¿‡ï¼"
