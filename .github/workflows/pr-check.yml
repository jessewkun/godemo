name: PR Check

on:
    pull_request:
        branches: [main]

env:
    GO_VERSION: "1.23.10"

permissions:
    contents: read
    packages: read

jobs:
    check:
        name: ä»£ç æ£€æŸ¥
        runs-on: ubuntu-latest
        steps:
            - name: æ£€å‡ºä»£ç 
              uses: actions/checkout@v3
              with:
                  token: ${{ secrets.PAT_TOKEN }}

            - name: è®¾ç½® Go ç¯å¢ƒ
              uses: actions/setup-go@v4
              with:
                  go-version: ${{ env.GO_VERSION }}

            - name: é…ç½® Git è®¿é—®ç§æœ‰ä»“åº“
              run: |
                  git config --global url."https://x-access-token:${{ secrets.PAT_TOKEN }}@github.com/".insteadOf "https://github.com/"

            - name: é…ç½® Go ç§æœ‰æ¨¡å—
              run: |
                  go env -w GOPROXY=https://goproxy.io,direct

            - name: ä¸‹è½½ä¾èµ–
              run: |
                  go install github.com/google/wire/cmd/wire@latest
                  make mod

            - name: ç¼–è¯‘æµ‹è¯•
              run: |
                  echo "å¼€å§‹ç¼–è¯‘æµ‹è¯•..."
                  make build

            - name: ä»£ç æ ¼å¼æ£€æŸ¥
              run: |
                  echo "æ£€æŸ¥ä»£ç æ ¼å¼..."
                  go fmt ./...
                  echo "æ£€æŸ¥ä»£ç é—®é¢˜..."
                  go vet ./...

            - name: è¿è¡Œæµ‹è¯•
              run: |
                  echo "è¿è¡Œå•å…ƒæµ‹è¯•..."
                  make test

            - name: æ£€æŸ¥ç¼–è¯‘äº§ç‰©
              run: |
                  if [ -f "bin/godemo" ]; then
                      echo "âœ… ç¼–è¯‘æˆåŠŸ"
                      ls -la bin/
                      echo "âœ… æ–‡ä»¶å¤§å°: $(du -h bin/godemo | cut -f1)"
                  else
                      echo "âŒ ç¼–è¯‘å¤±è´¥"
                      exit 1
                  fi

            - name: ä»£ç è´¨é‡æŠ¥å‘Š
              run: |
                  echo "=== ä»£ç è´¨é‡æ£€æŸ¥å®Œæˆ ==="
                  echo "âœ… ä»£ç æ ¼å¼æ£€æŸ¥é€šè¿‡"
                  echo "âœ… ä»£ç é—®é¢˜æ£€æŸ¥é€šè¿‡"
                  echo "âœ… ç¼–è¯‘æµ‹è¯•é€šè¿‡"
                  echo "âœ… å•å…ƒæµ‹è¯•é€šè¿‡"
                  echo "âœ… ç¼–è¯‘äº§ç‰©éªŒè¯é€šè¿‡"
                  echo "ğŸ‰ PRæ£€æŸ¥å…¨éƒ¨é€šè¿‡ï¼"
