name: Cron Test Environment CI/CD

on:
    push:
        branches: [test]
    workflow_dispatch:
        inputs:
            environment:
                description: "deploy environment"
                required: true
                default: "test"
                type: choice
                options:
                    - test

permissions:
    contents: read
    packages: read

jobs:
    deploy-cron-test:
        name: Deploy cron to test environment
        uses: ./.github/workflows/reusable-deploy.yml
        with:
            app_name: "godemo-cron"
            build_command: "build-cron"
            app_type: "cron"
            deploy_env: "test"
            target_path: "/root/godemo-cron"
            notify_title: "⏰ 【godemo后端Cron】测试环境上线通知"
            git_ref: ${{ github.ref }}
            commit_sha: ${{ github.sha }}
            pr_title: ${{ github.event.pull_request.title }}
            pr_url: ${{ github.event.pull_request.html_url }}
        secrets:
            pat_token: ${{ secrets.PAT_TOKEN }}
            remote_host: ${{ secrets.TEST_REMOTE_HOST }}
            remote_user: ${{ secrets.TEST_REMOTE_USER }}
            ssh_private_key: ${{ secrets.TEST_SSH_PRIVATE_KEY }}
            remote_port: ${{ secrets.TEST_REMOTE_PORT }}
            feishu_webhook: ${{ secrets.FEISHU_DEPLOY_TEST_WEBHOOK }}
